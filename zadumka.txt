Привет! Ты опытный программист с 10-летним стажем, и мне срочно нужен профессиональный бот "Polly Parser" для риелторов Краснодара с бюджетом 15 000₽. Вот полное и детализированное ТЗ слитным текстом:

Бот должен стабильно работать на VPS (Ubuntu 22.04, 4 ядра, 8Гб RAM, SSD) с Docker-развертыванием. Используем Python 3.10+ с асинхронной архитектурой на aiogram 3.x для обработки минимум 100 одновременных запросов. База данных - PostgreSQL 14 с еженедельным автоматическим бэкапом, Redis 6 для кеширования и очередей.

Для парсинга ЦИАН берем доработанный cianparser с GitHub и добавляем: точную фильтрацию только частных объявлений (исключаем все что от агентств и застройщиков), парсинг по Краснодару и ближайшим районам (Пашковский, Яблоновский, Энка, ГМР, ФМР, ЮМР, ЦМР, КМР, район РИП и все значимые спальные районы), сбор всех ключевых параметров (цена, площадь, жилая площадь, кухня, этаж/этажность, год постройки, материал стен, тип дома, санузел, балкон, отделка, вид из окон) с обязательным сохранением фото (первые 5 изображений в среднем качестве), контактов (только телефоны, email не нужны) и точной даты публикации. Частота обновления - строго каждые 30 минут с приоритетом самых свежих объявлений (в первую очередь берем объявления добавленные за последние 2 часа).

Для Авито модифицируем parser_avito: добавляем надежное определение частных объявлений (анализ текста на ключевые фразы типа "от собственника", "не агентство" и анализ истории объявлений пользователя), улучшенное извлечение контактов (включая телефоны скрытые в тексте через пробелы или спецсимволы), обработку динамической загрузки контента через Selenium с автоматическим рестартом при фризах, сбор аналогичного набора параметров как для ЦИАН (кроме тех что не применимы), сохранение первых 3 фото в оптимизированном размере. Частота обновления также каждые 30 минут с приоритетом новых объявлений.

Для Telegram-чатов реализуем гибкую систему: в админке добавляем возможность вручную вносить чаты (ссылку + название), настраивать ключевые слова фильтрации (по умолчанию: "продам", "квартира", "дом", "Краснодар", "частное", "собственник") с возможностью использовать regex, автоматическое определение и извлечение контактов (телефоны в любом формате), фильтрацию коммерческой недвижимости (исключаем слова "офис", "торговый", "помещение", "аренда" и т.д.). Парсинг новых сообщений каждые 10 минут (так как в чатах информация более динамичная).

Данные со всех источников сохраняем в PostgreSQL в нормализованную структуру: отдельные таблицы для объявлений (основные параметры), фото (ссылки + превью в base64), контактов (с отметкой о проверке), истории изменений цен. Дополнительно ежедневно делаем дамп в CSV для резерва. Для быстрого доступа к свежим данным используем Redis (кешируем топ-500 новых объявлений по каждому источнику).

Пользовательский интерфейс: при старте бота - информативное меню с кнопками "Найти объявления", "Мои фильтры", "Тарифы", "Промокод", "Рефералка", "Поддержка". По запросу выдается ровно 25 самых свежих объявлений (каждое отдельным сообщением с компактным форматированием: [Источник] [Цена] [Район] [Площадь] [Этаж] + первое фото (если есть) + кнопка "Показать контакт" (при нажатии показывает телефон с защитой от скрейпинга - например, через временный одноразовый ссылку). Фильтры индивидуальные для каждого пользователя: сохраняемые preset'ы по цене (от-до), площади, количеству комнат (можно указать "1-2" или "3+"), районам (мультивыбор из списка), типу жилья (новостройка/вторичка), этажу (можно указать "только не первый"), срочности (слова "срочно", "быстро" в заголовке). Лимит - 100 запросов в сутки для всех тарифов.

Платежная система через ЮMoney: три тарифа (300₽/день - доступ на 24 часа, 2900₽/месяц - 30 дней, 23000₽/год - 365 дней) с автоматической активацией после оплаты. Обязательные уведомления за 24, 3 и 1 час до окончания подписки. Система промокодов: я могу генерировать в админке промокоды на 24 часа доступа (одноразовые, привязка к юзернейму). Базовая реферальная система: пользователь получает ссылку вида t.me/pollyparser_bot?start=ref123
(где 123 - его ID), за каждого приглашенного (кто ввел /start по этой ссылке и оплатил любой тариф) - 10% от суммы на баланс (можно использовать для оплаты подписки).

Админ-панель (веб-интерфейс на FastAPI): авторизация по логину/паролю, управление (добавление/удаление) Telegram-чатами, ручной запуск/остановка парсеров, просмотр статистики (количество пользователей, запросов, популярные фильтры), массовая рассылка сообщений (с возможностью фильтрации по активности), генерация промокодов, экспорт данных в CSV (все объявления за выбранный период), просмотр логов ошибок. Для парсеров - мониторинг работы, автоматический рестарт при падении, отправка уведомлений мне в Telegram при критических ошибках.

Технические требования: обработка до 1000 RPS, время отклика не более 1.5 сек, защита от DDoS через nginx rate limiting, логирование всех критических действий (оплаты, ошибки парсеров). Без капчи, но защита от ботов через анализ поведения (если пользователь делает >50 запросов в минуту - временная блокировка на 10 минут).

Сроки - максимально сжатые. Готов рассмотреть твои предложения по оптимизации, но ключевой функционал должен быть выполнен полностью. P.S. Все парсеры должны быть максимально стабильные - если источник меняет API или структуру, важно быстро это обнаружить и исправить (логировать все изменения в структуре данных). вот ссылки на парсеры https://github.com/lenarsaitov/cianparser https://github.com/Duff89/parser_avito. 
